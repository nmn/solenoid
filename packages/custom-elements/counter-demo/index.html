<html>
  <head>
    <title>Counter Test</title>
    <script src="../lib/index.js"></script>
  </head>
  <script>
    function initDark() {
      try {
        DarkReader.enable({
          brightness: 100,
          contrast: 90,
          sepia: 10,
        });
        console.log("Dark mode enabled");
      } catch (e) {
        console.warn("Error enabling DarkReader:", e);
      }
    }
  </script>
  <script
    onload="initDark()"
    src="https://cdnjs.cloudflare.com/ajax/libs/darkreader/4.9.100/darkreader.js"
    integrity="sha512-VrShkHBDBKBOP8ZSAhsgf035s7Go+x3ClNZCmqDBtJNsVIq9Nd88KVUQPF+RyoveDW+KLv2Nz/Ya4+eqHm16tg=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  ></script>

  <!--
		Example with let-signal, signal-attrs, signal-text

		const count = signal(0);
		const decr = ()=>count(count()-1);
		const incr = ()=>count(count()+1);

		return (
			<>
				<button onClick={decr}>-</button>
				{count()}
				<button onClick={incr}>+</button>
			</>
		);
	-->
  <let-signal name="count" initial-value="0"></let-signal>
  <script>
    window.__FNS__.decr = ($c1) => () => $c1($c1() - 1);
    window.__FNS__.decAttrs = ($c1) => () => ({ onClick: $c1 });
  </script>
  <signal-attrs
    value='{"__type":"$$FUNCTION","module":"decAttrs","closure":[{"__type":"$$FUNCTION","module":"decr","closure":[{"__type":"$$SIGNAL","id":"count"}]}]}'
  >
    <button>-</button>
  </signal-attrs>
  <signal-text value='{"__type":"$$SIGNAL","id":"count"}'> 0 </signal-text>
  <script>
    window.__FNS__.incr = ($c1) => () => $c1($c1() + 1);
    window.__FNS__.attrs = ($c1) => () => ({ onClick: $c1 });
  </script>
  <signal-attrs
    value='{"__type":"$$FUNCTION","module":"attrs","closure":[{"__type":"$$FUNCTION","module":"incr","closure":[{"__type":"$$SIGNAL","id":"count"}]}]}'
  >
    <button>+</button>
  </signal-attrs>


  <br />
  <br />


	<!--
		Example with show-when

		const whenEven = ()=>count()%2 === 0;
		const whenOdd = ()=>count()%2 === 1;

		if (whenEven()) {
			return "is Even!";
		}
		else if (whenOdd()) {
			return "is Odd!";
		}

		return null;
	-->
  <script>
    window.__FNS__.whenEven = ($c1) => () => $c1() % 2 === 0;
    window.__FNS__.whenOdd = ($c1) => () => $c1() % 2 !== 0;
  </script>
  <show-when
    condition='{"__type":"$$FUNCTION","module":"whenEven","closure":[{"__type":"$$SIGNAL","id":"count"}]}'
  >
    is Even!
  </show-when>
  <show-when
    condition='{"__type":"$$FUNCTION","module":"whenOdd","closure":[{"__type":"$$SIGNAL","id":"count"}]}'
  >
    is Odd!
  </show-when>


	<!-- Unfinished -- for-each example -->
		<!--
			const counterValues = createSignal([-4,1,6]); // Render 3 counters next to each other, each with a different initial value & state
			
			const decrIndex = (index)=>{
				const nextCounterValues = [...counterValues()];
				nextCounterValues[index]--;
				counterValues(nextCounterValues);
			};
			
			const incrIndex = (index)=>{
				const nextCounterValues = [...counterValues()];
				nextCounterValues[index]++;
				counterValues(nextCounterValues);
			};

			return (
				<for-each
					values={counterValues}
					map={(counterValue, index)=>(
						<div style={{display: 'block'}}>
							<button onClick={()=>decrIndex(index())}>-</button>
							{counterValue()}
							<button onClick={()=>incrIndex(index())}>-</button>
						</div>
					)}
				/>
			);
		-->
		<script>
			window.__FNS__.decrIndex = ($c1)=>($p1)=>{
				console.log('decrement');
				const arr = $c1();
				const nextCounterValues = [...arr];
				nextCounterValues[$p1]--;
				$c1(nextCounterValues);
			}

			window.__FNS__.incrIndex = ($c1)=>($p1)=>{
				console.log('called incr');
				const nextCounterValues = [...$c1()];
				nextCounterValues[$p1]++;
				$c1(nextCounterValues);
			}

			window.__FNS__.__counterValues__map__decr = (decrIndex) => (counterValue, index) => {
				return ()=>decrIndex(index());
			}

			// window.__FNS__.__counterValues__map = ($c1/*decrIndex*/, $c2/*incrIndex*/)=>($p1/*val*/, $p2/*index*/)=>{
			// 	// this is JSX transform, not solenoid logic
			// 	const __a = document.createElement('div');
			// 	Object.assign(__a.style, {
			// 		display: 'block',
			// 	});

			// 	const __a_a = document.createElement('button');
			// 	__a_a.addEventListener('click', ()=>$c1($p2));
			// 	__a_a.innerText = '-';

			// 	const __a_b = $p1();

			// 	const __a_c = document.createElement('button');
			// 	__a_c.addEventListener('click', ()=>$c2($p2));
			// 	__a_c.innerText = '+';

			// 	__a.append(__a_a, __a_b, __a_c);
			// 	return __a;
			// }

			window.__FNS__.__decrIndex_withClosure = (decrIndex, index) => () => decrIndex(index());

			window.__FNS__.__getIndex_injected = ()=>()=>{
				const listItem = document.getElementById('#81051');
				const index = Number(listItem.getAttribute('index'));
				console.log('got index', index);
				return index;
			}

			window.__FNS__.__getOnClickByIndex = (counterValues)=>()=>{
				return {onClick: window.__FNS__.__decrIndex_withClosure(
					window.__FNS__.decrIndex(counterValues),
					window.__FNS__.__getIndex_injected(),
				)};
			}

			window.__FNS__.__getComputedValue = (counterValues)=>()=>{
				return counterValues()[0];
			}
		</script>
		<let-signal name="counterValues" initial-value="[-4,1,6]"></let-signal>
		<for-each
			values='{"__type":"$$SIGNAL","id":"counterValues"}'
		>
			<list-item index="0" id="#81051">
				<!-- <template> -->
					<!-- "onClick": {
									"__type": "$$FUNCTION",
									"module": "__decrIndex_withClosure",
									"closure": [
										{
											"__type":"$$FUNCTION",
											"module":"decrIndex",
											"closure": [
												{"__type":"$$SIGNAL","id":"counterValues"}
											]
										},
										{
											"__type":"$$FUNCTION",
											"module":"__getIndex_injected",
											"closure":[]
										}
									]
								} -->
					<div style="display: block;">
						<signal-attrs
							value='{
								"__type": "$$FUNCTION",
								"module": "__getOnClickByIndex",
								"closure": [
									{"__type":"$$SIGNAL","id":"counterValues"}
								]
							}'
						>
							<button>-</button>
						</signal-attrs>
						<signal-text value='{
							"__type":"$$COMPUTED",
							"signal":{"__type":"$$SIGNAL","id":"counterValues"},
							"compute": {
								"__type":"$$FUNCTION",
								"module":"__getComputedValue",
								"closure": [{"__type":"$$SIGNAL","id":"counterValues"}]
							}
						}'>
						</signal-text>
					</div>
				<!-- </template> -->
			</list-item>
		</for-each>

</html>


<!-- map='{
	"__type":"$$FUNCTION",
	"module":"__counterValues__map",
	"closure":[
		{
			"__type":"$$FUNCTION",
			"module":"decrIndex",
			"closure": [
				{"__type":"$$SIGNAL","id":"counterValues"}
			]
		},
		{
			"__type":"$$FUNCTION",
			"module":"incrIndex",
			"closure": [
				{"__type":"$$SIGNAL","id":"counterValues"}
			]
		}
	]
}' -->

<!-- 
"module":"__counterValues__map__decr",
"closure":[{
	"__type":"$$FUNCTION",
	
	"module":"__counterValues__map__decr",
	"closure":[{
		"__type":"$$FUNCTION",
		"module":"decrIndex",
		"closure": [
			{
				"__type": "$$SIGNAL",
				"id": "counterValues"
			}
		]
	}]
}]
-->
